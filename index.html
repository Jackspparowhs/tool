<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Map — PirateRuler.com</title>
<meta name="description" content="Simple full-screen map — PirateRuler. Google Maps style with Places Autocomplete & locate." />
<meta name="theme-color" content="#071225" />
<link rel="icon" href="https://pirateruler.com/static/pr-logo.png" type="image/png">

<style>
  /* Keep your header look, but map will be full-screen under it */
  :root{
    --space: 12px;
    --text-sans: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    --accent-a: #6bbf4a;
    --accent-b: #2fa64f;
    --bg: #071225;
    --muted: #98a7bf;
    --text: #e9f1ff;
  }
  html,body{height:100%;margin:0;font-family:var(--text-sans);-webkit-font-smoothing:antialiased;color:var(--text);background:var(--bg)}
  a{color:inherit;text-decoration:none}
  header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:transparent;gap:12px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:52px;height:52px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent-a),var(--accent-b));color:#06221a;font-weight:900;font-size:18px}
  .title{font-weight:800;font-size:16px}
  .sub{font-size:12px;color:var(--muted)}
  .controls{display:flex;gap:8px;align-items:center}

  /* Top controls (search + buttons) — overlay on map */
  .map-controls {
    position: absolute;
    top: 16px;
    left: 16px;
    right: 16px;
    display:flex;
    gap:12px;
    align-items:center;
    z-index: 1000;
    pointer-events: none; /* allow only inner controls to be clickable */
  }
  .map-controls .left, .map-controls .right { pointer-events: auto; display:flex; gap:8px; align-items:center; }
  .search-box {
    display:flex; align-items:center; gap:8px; padding:8px 10px; border-radius:10px; background:rgba(255,255,255,0.95);
    box-shadow: 0 6px 18px rgba(2,8,20,0.35);
    width: min(720px, calc(100% - 160px));
  }
  input#autocomplete {
    border:0; outline:0; font-size:15px; padding:6px; width:100%;
  }
  .btn {
    background:linear-gradient(90deg,var(--accent-a),var(--accent-b)); color:#06221a; font-weight:800; padding:8px 12px; border-radius:10px; border:0; cursor:pointer;
  }
  .btn.ghost {
    background:transparent; color:#fff; border:1px solid rgba(255,255,255,0.08);
  }

  /* Map fills viewport below header (header is small) */
  #map {
    position:fixed;
    top:72px; /* header height (approx) */
    left:0; right:0; bottom:0;
    z-index: 0;
  }

  /* small floating info */
  .floating-info {
    position: absolute;
    left: 16px;
    bottom: 16px;
    z-index: 1000;
    background: rgba(0,0,0,0.55);
    color: #fff;
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 13px;
  }

  /* mobile tweaks */
  @media(max-width:720px){
    header{padding:10px}
    .map-controls{top:12px;left:10px;right:10px}
    .search-box{width:calc(100% - 120px)}
    #map { top: 64px; }
  }
</style>
</head>
<body>
  <!-- header (keeps your look) -->
  <header>
    <div class="brand">
      <div class="logo">PR</div>
      <div>
        <div class="title">Map</div>
        <div class="sub">by PirateRuler.com</div>
      </div>
    </div>
    <div class="controls" aria-hidden="true">
      <!-- keep small header controls but main search is on map -->
      <button id="themeBtn" class="btn ghost" title="Toggle theme">Theme</button>
    </div>
  </header>

  <!-- map controls overlay (search + actions) -->
  <div class="map-controls" role="region" aria-label="Map controls">
    <div class="left">
      <div class="search-box" role="search" aria-label="Place search">
        <input id="autocomplete" type="text" placeholder="Search place, address, or airport (powered by Google)" aria-label="Search">
        <button id="searchBtn" class="btn">Go</button>
      </div>
    </div>
    <div class="right">
      <button id="locateBtn" class="btn">Locate me</button>
      <button id="clearBtn" class="btn ghost">Clear</button>
    </div>
  </div>

  <!-- Google map -->
  <div id="map" aria-label="Map"></div>

  <div class="floating-info" id="floatingInfo">Powered by Google Maps</div>

  <!-- Load Google Maps JS (replace YOUR_GOOGLE_MAPS_API_KEY) -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places&callback=initMap"
    async defer>
  </script>

  <script>
    // Replace YOUR_GOOGLE_MAPS_API_KEY with your key before loading this page.
    // Make sure Maps JavaScript API + Places API are enabled in Google Cloud Console.

    let map, marker, infoWindow, autocomplete, placesService;

    function initMap(){
      // Start centered at world-ish view (user can search or locate)
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 20.0, lng: 0.0 },
        zoom: 3,
        mapTypeControl: false,
        fullscreenControl: true,
        streetViewControl: false,
        gestureHandling: 'greedy'
      });

      // single marker used for search / clicks
      marker = new google.maps.Marker({ map, visible: false, clickable: true });

      // infoWindow for marker
      infoWindow = new google.maps.InfoWindow();

      // click map to place marker and show lat/lng
      map.addListener('click', (e) => {
        placeMarker(e.latLng);
      });

      // Places Autocomplete for the search input
      const input = document.getElementById('autocomplete');
      autocomplete = new google.maps.places.Autocomplete(input, {
        fields: ["geometry","formatted_address","name","place_id"],
        types: ["geocode", "establishment"]
      });
      autocomplete.bindTo('bounds', map);

      autocomplete.addListener('place_changed', () => {
        const place = autocomplete.getPlace();
        if(!place.geometry){
          // fallback: user typed but place not returned
          return;
        }
        const loc = place.geometry.location;
        map.panTo(loc);
        map.setZoom(13);
        placeMarker(loc, place.formatted_address || place.name);
      });

      // also support pressing the "Go" button to search the input value using Places TextSearch
      document.getElementById('searchBtn').addEventListener('click', async () => {
        const q = input.value.trim();
        if(!q) return;
        // Use PlacesService textSearch for general queries
        if(!placesService) placesService = new google.maps.places.PlacesService(map);
        placesService.textSearch({ query: q, type: ['establishment','airport','point_of_interest'] }, (results, status) => {
          if(status === google.maps.places.PlacesServiceStatus.OK && results && results.length){
            const r = results[0];
            const loc = r.geometry.location;
            map.panTo(loc);
            map.setZoom(13);
            placeMarker(loc, r.formatted_address || r.name);
          } else {
            // fallback: use geocoder
            const geocoder = new google.maps.Geocoder();
            geocoder.geocode({ address: q }, (res, gs) => {
              if(gs === 'OK' && res && res.length){
                const p = res[0];
                map.panTo(p.geometry.location);
                map.setZoom(13);
                placeMarker(p.geometry.location, p.formatted_address);
              } else {
                alert('No results found');
              }
            });
          }
        });
      });

      // locate me button
      document.getElementById('locateBtn').addEventListener('click', () => {
        if(navigator.geolocation){
          navigator.geolocation.getCurrentPosition((pos) => {
            const latLng = { lat: pos.coords.latitude, lng: pos.coords.longitude };
            map.panTo(latLng);
            map.setZoom(14);
            placeMarker(latLng, 'You are here');
          }, (err) => {
            alert('Location error: ' + (err.message || err.code));
          }, { enableHighAccuracy: true, timeout: 10000 });
        } else {
          alert('Geolocation not supported by your browser.');
        }
      });

      // clear button
      document.getElementById('clearBtn').addEventListener('click', () => {
        marker.setVisible(false);
        infoWindow.close();
      });

      // marker click show info
      marker.addListener('click', () => {
        if(marker.getPosition()){
          infoWindow.open({ anchor: marker, map, shouldFocus: false });
        }
      });

      // theme button just toggles document background (keeps it simple)
      document.getElementById('themeBtn').addEventListener('click', () => {
        document.body.style.background = document.body.style.background === 'white' ? '#071225' : 'white';
        // tweak control colors for readability
        const floating = document.getElementById('floatingInfo');
        floating.style.background = document.body.style.background === 'white' ? 'rgba(0,0,0,0.6)' : 'rgba(0,0,0,0.55)';
      });
    }

    // place marker helper: accepts LatLng or {lat,lng}
    function placeMarker(latLng, title){
      if(latLng.lat !== undefined) {
        // plain object
        marker.setPosition(new google.maps.LatLng(latLng.lat, latLng.lng));
      } else {
        marker.setPosition(latLng);
      }
      marker.setVisible(true);

      // build popup content
      const pos = marker.getPosition();
      const content = `<div style="font-weight:900">${title ? escapeHtml(title) : 'Location'}</div>
        <div style="font-size:13px;color:#444">Lat: ${pos.lat().toFixed(6)}<br>Lng: ${pos.lng().toFixed(6)}</div>`;
      infoWindow.setContent(content);
      infoWindow.open({ anchor: marker, map, shouldFocus: false });
    }

    // small utility to escape HTML in titles
    function escapeHtml(str){ return String(str||'').replace(/[&<>"']/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch])); }

    // Expose reload function to console (if needed)
    window.placeAt = function(lat, lng, label){ placeMarker({lat:lat, lng:lng}, label || 'Pinned'); map.setZoom(13); map.panTo({lat, lng}); };

    // Google will call initMap after API loads (callback param)
  </script>
</body>
</html>
