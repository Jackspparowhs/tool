<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Map — PirateRuler.com</title>
<meta name="description" content="Simple full-screen map by PirateRuler — search, locate, click to drop marker. No API keys." />
<meta name="theme-color" content="#0a1b3a" />
<link rel="icon" href="https://pirateruler.com/static/pr-logo.png" type="image/png">

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
  :root{
    --space:12px;
    --text-sans:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    --blue-a:#0b63d6; /* primary blue */
    --blue-b:#0a49b3;
    --bg:#071225;
    --muted:#9fb3d9;
    --text:#e9f1ff;
  }
  html,body{height:100%;margin:0;font-family:var(--text-sans);-webkit-font-smoothing:antialiased;background:var(--bg);color:var(--text)}
  a{color:inherit;text-decoration:none}
  /* header (keeps your look) */
  header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;background:transparent;position:fixed;top:0;left:0;right:0;z-index:1200}
  .wrap{max-width:1100px;margin:0 auto;width:100%;padding-left:var(--space);padding-right:var(--space);box-sizing:border-box}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--blue-a),var(--blue-b));display:flex;align-items:center;justify-content:center;font-weight:900;color:white;font-size:18px;box-shadow:0 8px 20px rgba(2,8,20,0.4)}
  .title{font-weight:800;font-size:16px}
  .sub{font-size:12px;color:var(--muted)}
  .controls{display:flex;gap:10px;align-items:center}

  /* top floating map controls container (overlay) */
  .map-controls {
    position: fixed;
    top:82px; /* leave header visible */
    left: 16px;
    right: 16px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    z-index:1200;
    pointer-events:none; /* only inner controls clickable */
  }
  .map-controls .left, .map-controls .right { pointer-events:auto; display:flex; gap:10px; align-items:center; }
  .search {
    display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.98);padding:8px;border-radius:12px;
    box-shadow:0 8px 30px rgba(2,8,20,0.35); width: min(720px, calc(100% - 160px));
  }
  input#searchInput{border:0;outline:0;padding:6px;font-size:15px;width:100%;color:#06203a;background:transparent}
  button.btn {background:linear-gradient(90deg,var(--blue-a),var(--blue-b));color:white;border:0;padding:8px 12px;border-radius:10px;font-weight:800;cursor:pointer}
  button.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--text)}

  /* full-screen map area under header */
  #map {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 0;
  }
  /* we keep header and floating controls above map; provide spacing so header doesn't cover map content visually */
  .content-spacer { height: 140px; } /* header + controls space so map features don't hide under them */

  /* floating footer attribution */
  .attribution {
    position: fixed;
    left: 16px;
    bottom: 16px;
    z-index:1200;
    background: rgba(6, 18, 40, 0.8);
    color: #dfeeff;
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 13px;
  }

  /* small popup style override for leaflet popups on dark bg */
  .leaflet-popup-content-wrapper { background: #fff; color: #06203a }
  .leaflet-popup-tip { background: #fff }

  @media(max-width:720px){
    .map-controls { top:74px; left:10px; right:10px; }
    .search { width: calc(100% - 90px); }
  }
</style>
</head>
<body>
  <!-- Header (keeps design) -->
  <header>
    <div class="wrap" style="display:flex;align-items:center;justify-content:space-between;">
      <div style="display:flex;align-items:center;gap:12px">
        <div class="logo" aria-hidden="true">PR</div>
        <div>
          <div class="title">Map</div>
          <div class="sub">by PirateRuler.com</div>
        </div>
      </div>

      <div class="controls" role="navigation" aria-label="Header controls">
        <button id="themeToggle" class="btn ghost" aria-pressed="false">Theme</button>
      </div>
    </div>
  </header>

  <!-- floating map controls (search, locate, clear) -->
  <div class="map-controls">
    <div class="left">
      <div class="search" role="search" aria-label="Place search">
        <input id="searchInput" type="search" placeholder="Search place, address, airport..." aria-label="Search">
        <button id="searchBtn" class="btn">Search</button>
      </div>
    </div>

    <div class="right">
      <button id="locateBtn" class="btn">Locate me</button>
      <button id="clearBtn" class="btn ghost">Clear</button>
    </div>
  </div>

  <!-- Map container -->
  <div id="map" aria-label="Map"></div>

  <!-- small spacer element for layout (optional) -->
  <div class="content-spacer" aria-hidden="true"></div>

  <!-- attribution text per your request -->
  <div class="attribution">Powered by PirateRuler.com</div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
  // Simple full-screen Leaflet map, blue accents, Nominatim search, no API key required.

  // Create map and set a friendly default view
  const map = L.map('map', { zoomControl: true }).setView([20.0, 0.0], 3);

  // Clean CartoDB Positron tiles (light and human-friendly)
  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
    maxZoom: 19
  }).addTo(map);

  // Single marker layer for search/click
  const markerLayer = L.layerGroup().addTo(map);

  // UI elements
  const searchInput = document.getElementById('searchInput');
  const searchBtn = document.getElementById('searchBtn');
  const locateBtn = document.getElementById('locateBtn');
  const clearBtn = document.getElementById('clearBtn');
  const themeToggle = document.getElementById('themeToggle');

  // Place marker and popup helper
  function placeMarker(lat, lon, label){
    markerLayer.clearLayers();
    const m = L.marker([lat, lon]).addTo(markerLayer);
    const content = `<div style="font-weight:900">${sanitize(label || 'Pinned location')}</div>
                     <div style="font-size:13px;color:#444">Lat: ${lat.toFixed(6)}<br>Lon: ${lon.toFixed(6)}</div>`;
    m.bindPopup(content).openPopup();
    map.setView([lat, lon], 13);
  }

  // Click on map places marker
  map.on('click', (e) => {
    placeMarker(e.latlng.lat, e.latlng.lng, 'Pinned location');
  });

  // Locate me
  locateBtn.addEventListener('click', () => {
    if(!navigator.geolocation){ alert('Geolocation not supported'); return; }
    locateBtn.disabled = true;
    locateBtn.textContent = 'Locating…';
    navigator.geolocation.getCurrentPosition(pos => {
      locateBtn.disabled = false;
      locateBtn.textContent = 'Locate me';
      placeMarker(pos.coords.latitude, pos.coords.longitude, 'You are here');
    }, err => {
      locateBtn.disabled = false;
      locateBtn.textContent = 'Locate me';
      alert('Location error: ' + (err.message || err.code));
    }, { enableHighAccuracy: true, timeout: 10000 });
  });

  // Clear
  clearBtn.addEventListener('click', () => {
    markerLayer.clearLayers();
  });

  // Nominatim search (public)
  async function nominatimSearch(q){
    if(!q) return null;
    const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}&addressdetails=1&limit=6`;
    try{
      const resp = await fetch(url, { headers: { 'Accept-Language': 'en' } });
      if(!resp.ok) throw new Error('HTTP ' + resp.status);
      return await resp.json();
    }catch(e){
      console.warn('Search failed', e);
      return null;
    }
  }

  // Search button handler
  searchBtn.addEventListener('click', async () => {
    const q = searchInput.value.trim();
    if(!q) return;
    searchBtn.disabled = true;
    searchBtn.textContent = 'Searching…';
    const res = await nominatimSearch(q);
    searchBtn.disabled = false;
    searchBtn.textContent = 'Search';
    if(!res || res.length === 0){ alert('No results'); return; }
    const first = res[0];
    const lat = parseFloat(first.lat), lon = parseFloat(first.lon);
    const label = first.display_name || q;
    placeMarker(lat, lon, label);
  });

  // Press Enter to search
  searchInput.addEventListener('keydown', (e) => { if(e.key === 'Enter') searchBtn.click(); });

  // Theme toggle (just toggles background for now)
  themeToggle.addEventListener('click', () => {
    const body = document.body;
    if(body.style.background === 'white'){
      body.style.background = 'var(--bg)';
      themeToggle.textContent = 'Theme';
    } else {
      body.style.background = 'white';
      themeToggle.textContent = 'Theme';
    }
  });

  // small sanitize helper for popup text
  function sanitize(s){ return String(s||'').replace(/[&<>"']/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch])); }

  // Ensure map invalidation after page load so it fills correctly on mobile
  window.requestAnimationFrame(()=>{ setTimeout(()=>{ map.invalidateSize(); }, 50); });

  </script>
</body>
</html>
