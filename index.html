<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Internet Speed ‚Äî PirateRuler.com</title>
<meta name="description" content="PirateRuler Internet Speed Test ‚Äî client-side speed check (latency, download, upload). No tracking." />
<meta name="theme-color" content="#071225" />
<link rel="icon" href="https://pirateruler.com/static/pr-logo.png" type="image/png">
<link rel="apple-touch-icon" href="https://pirateruler.com/static/pr-logo.png">

<style>
  /* -------------------------
     Design tokens (kept)
     ------------------------- */
  :root{
    --space: 16px;
    --radius: 14px;
    --text-sans: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Helvetica Neue";
    --accent-a: #0A84FF; /* primary accent (blue) */
    --accent-b: #0066ff;
    --accent-c: #ff5aa4;
    --bg: linear-gradient(180deg,#061028 0%, #071225 50%);
    --card-dark: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    --glass: rgba(255,255,255,0.03);
    --muted: #98a7bf;
    --muted-2: rgba(233,241,255,0.14);
    --text: #e9f1ff;
    --radius-lg: 22px;
    --shadow-lg: 0 20px 50px rgba(2,8,20,0.6);
    --shadow-soft: 0 10px 30px rgba(2,8,20,0.35);
    --max-width: 1100px;
    --offcanvas-bg: #061028;
    --offcanvas-link-bg: rgba(255,255,255,0.02);
  }
  html.light {
    --bg: linear-gradient(180deg,#f7fbfe,#f3f7fb);
    --card-dark: linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.01));
    --glass: rgba(11,17,28,0.03);
    --muted: #6b7480;
    --muted-2: rgba(11,17,36,0.06);
    --text: #071225;
    --shadow-lg: 0 18px 50px rgba(3,12,30,0.06);
    --shadow-soft: 0 8px 24px rgba(3,12,30,0.06);
    --offcanvas-bg: #ffffff;
    --offcanvas-link-bg: rgba(11,17,36,0.03);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:var(--text-sans);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    color:var(--text);
    background:var(--bg);
    padding:var(--space);
    line-height:1.45;
  }
  a{color:inherit;text-decoration:none}
  img{max-width:100%;height:auto;display:block}
  .wrap{max-width:var(--max-width);margin:0 auto;padding-bottom:60px}

  header {
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding:12px;
    border-radius:12px;
    background:transparent;
    margin-bottom:12px;
  }
  .brand {display:flex; gap:12px; align-items:center}
  .logo {
    width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;
    background:linear-gradient(135deg,var(--accent-a),var(--accent-b)); color:white; font-weight:900; font-size:18px;
    box-shadow:var(--shadow-soft);
    flex-shrink:0;
  }
  .brand .title {font-weight:800; font-size:16px; margin-bottom:2px}
  .brand .sub {font-size:12px;color:var(--muted)}
  .controls {display:flex;gap:10px;align-items:center}

  .theme-btn{
    display:inline-flex;align-items:center;justify-content:center;padding:10px;border-radius:999px;background:var(--card-dark);border:0;
    width:48px;height:48px;box-shadow:var(--shadow-soft);cursor:pointer;color:var(--text);
  }
  .hamb {
    width:48px;height:48px;border-radius:12px; display:flex; align-items:center; justify-content:center;
    background:var(--card-dark); box-shadow:var(--shadow-soft); border:0; cursor:pointer; color:var(--text);
  }

  .hero {
    border-radius:18px;
    padding:28px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    box-shadow:var(--shadow-lg);
    text-align:center;
    position:relative;
    overflow:visible;
  }
  .kicker {
    display:inline-block;padding:6px 12px;border-radius:999px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    color:var(--muted); font-weight:700;font-size:13px;margin-bottom:12px;
  }
  .h1 {font-size:34px;font-weight:900; margin:6px 0 8px; line-height:1.03; letter-spacing:-0.02em}
  .lead {max-width:920px;margin:0 auto;color:var(--muted); font-size:15px}

  .hero-cta {margin-top:20px;display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
  .btn-primary {
    background:linear-gradient(90deg,var(--accent-a),var(--accent-b));
    color:white;padding:14px 26px;border-radius:14px;font-weight:900;border:0;box-shadow:0 18px 40px rgba(10,132,255,0.18);
    display:inline-flex;align-items:center;gap:10px;font-size:16px
  }
  .btn-ghost {
    background:transparent;border:1px solid var(--muted-2); padding:12px 18px;border-radius:12px;color:var(--muted);font-weight:800;
  }

  .stats {display:flex;gap:12px;justify-content:center;margin-top:18px;flex-wrap:wrap}
  .stat {
    padding:12px 18px;border-radius:12px;background:var(--card-dark); box-shadow:var(--shadow-soft);
    min-width:140px;text-align:center;
  }
  .stat .num{font-weight:900;font-size:20px}
  .stat .lbl{font-size:13px;color:var(--muted);margin-top:6px}

  .main-grid {display:grid;grid-template-columns:1fr 380px;gap:18px;margin-top:22px;align-items:start}
  @media(max-width:980px){ .main-grid{ grid-template-columns: 1fr } .hero .h1{font-size:28px} }

  .panel {background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:14px; padding:18px; box-shadow:var(--shadow-soft)}
  h2.section {margin:0 0 8px 0;font-size:20px;font-weight:900}

  /* center the test card */
  .test-card {
    display:flex;
    flex-direction:column;
    gap:14px;
    align-items:center;
    padding:28px;
    border-radius:16px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    box-shadow:var(--shadow-soft);
  }

  .big-num {
    font-size:40px;
    font-weight:900;
    letter-spacing:-0.02em;
  }

  .small {
    color:var(--muted);
    font-size:13px;
  }

  .btn-run {
    background:linear-gradient(90deg,var(--accent-a),var(--accent-b));
    color:white;padding:12px 24px;border-radius:12px;font-weight:900;border:0;cursor:pointer;font-size:16px;
    box-shadow:0 12px 30px rgba(10,132,255,0.18);
  }
  .btn-stop {
    background:transparent;border:1px solid var(--muted-2); padding:10px 16px;border-radius:12px;color:var(--muted);font-weight:800;cursor:pointer;
  }

  .progress {
    width:100%;
    height:10px;
    background:rgba(255,255,255,0.03);
    border-radius:999px;
    overflow:hidden;
  }
  .progress > i {
    display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent-a),var(--accent-b));
  }

  .footer-note {margin-top:8px;color:var(--muted);font-size:13px}

  footer {margin-top:28px;text-align:center}
  footer .visit {display:inline-block;padding:12px 20px;border-radius:999px;background:linear-gradient(90deg,var(--accent-c),var(--accent-a));color:white;font-weight:800;box-shadow:0 14px 40px rgba(139,60,140,0.14)}
  footer small{display:block;margin-top:10px;color:var(--muted);font-size:13px}
</style>
</head>
<body class="">
  <div class="wrap">
    <!-- header -->
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">PR</div>
        <div>
          <div class="title">Internet Speed</div>
          <div class="sub">by PirateRuler.com</div>
        </div>
      </div>

      <div class="controls" role="navigation" aria-label="Header controls">
        <button id="toggleTheme" class="theme-btn" title="Toggle theme" aria-pressed="false">‚òÄÔ∏è</button>
        <button id="openMenu" class="hamb" aria-controls="menu" aria-expanded="false" title="Open menu">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 7h16M4 12h16M4 17h16" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
      </div>
    </header>

    <!-- hero -->
    <section class="hero" aria-labelledby="hero-title">
      <div class="kicker">Quick, privacy-friendly</div>
      <h1 id="hero-title" class="h1">Check your Internet speed ‚Äî client-side</h1>
      <p class="lead">Measure latency, download and upload speeds directly from your browser. No account, no tracking ‚Äî results stay on your device unless you share them.</p>

      <div class="hero-cta">
        <button class="btn-primary" id="runTestBtn" aria-label="Run speed test">Run Speed Test</button>
        <button class="btn-ghost" id="stopTestBtn" style="display:none">Stop</button>
      </div>

      <div class="stats" aria-hidden="true" style="margin-top:18px">
        <div class="stat">
          <div class="num">Latency</div>
          <div class="lbl" id="latencyLbl">‚Äî ms</div>
        </div>
        <div class="stat">
          <div class="num">Download</div>
          <div class="lbl" id="downloadLbl">‚Äî Mbps</div>
        </div>
        <div class="stat">
          <div class="num">Upload</div>
          <div class="lbl" id="uploadLbl">‚Äî Mbps</div>
        </div>
      </div>
    </section>

    <!-- main content -->
    <div class="main-grid" style="margin-top:20px">
      <div>
        <section class="panel test-card" aria-labelledby="test-card">
          <div style="text-align:center">
            <div class="big-num" id="showMain">‚Äî</div>
            <div class="small" id="showLabel">Run a test to see your speed</div>
          </div>

          <div style="width:100%;max-width:560px">
            <div class="progress" aria-hidden="true"><i id="progressBar"></i></div>
            <div style="display:flex;justify-content:space-between;margin-top:8px">
              <div class="small">Latency <span id="miniLatency">‚Äî</span></div>
              <div class="small">Download <span id="miniDownload">‚Äî</span></div>
              <div class="small">Upload <span id="miniUpload">‚Äî</span></div>
            </div>
          </div>

          <div style="display:flex;gap:10px;align-items:center">
            <button class="btn-primary" id="runBtn">Run test</button>
            <button class="btn-stop" id="abortBtn" style="display:none">Abort</button>
            <div style="flex:1"></div>
            <div class="footer-note">Estimation only ‚Äî for accurate results use dedicated services.</div>
          </div>
        </section>

        <section class="panel" style="margin-top:14px">
          <h2 class="section">How this works</h2>
          <p class="muted">This test estimates speeds by timing downloads and uploads from public endpoints (httpbin.org). It measures round-trip times (latency), download bit rate, and upload bit rate. Results are approximate ‚Äî many factors (network, server distance, device) affect numbers.</p>
        </section>

        <section class="panel" style="margin-top:14px">
          <h2 class="section">Tips</h2>
          <ul class="muted" style="margin:0 0 0 18px;padding:0">
            <li>Run the test on Wi-Fi or mobile to compare.</li>
            <li>Close other downloads / streaming apps for best results.</li>
            <li>Run multiple times (results vary).</li>
          </ul>
        </section>
      </div>

      <aside class="right-col" aria-label="Sidebar content">
        <div class="preview-card panel">
          <h3 style="margin-top:0">Last result</h3>
          <div style="display:flex;flex-direction:column;gap:8px">
            <div><strong>Latency:</strong> <span id="lastLatency">‚Äî ms</span></div>
            <div><strong>Download:</strong> <span id="lastDownload">‚Äî Mbps</span></div>
            <div><strong>Upload:</strong> <span id="lastUpload">‚Äî Mbps</span></div>
            <div style="height:8px"></div>
            <a class="mini-cta" id="shareBtn" href="#" style="text-decoration:none">Share result ‚Üí</a>
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="panel">
          <h3 style="margin:0 0 8px 0">Developer notes</h3>
          <p class="muted">This is a demo client-side implementation using public endpoints for quick, no-backend tests. For production-grade testing, use a dedicated speedtest provider or host your own test files.</p>
        </div>
      </aside>
    </div>

    <footer>
      <a class="visit" href="https://pirateruler.com" target="_blank" rel="noopener noreferrer">Visit PirateRuler.com</a>
      <small id="copyright" style="display:block;margin-top:12px;color:var(--muted)">¬© <span id="year"></span> PirateRuler ‚Äî Speed Test.</small>
    </footer>
  </div>

<script>
  document.getElementById('year').textContent = new Date().getFullYear();

  // Theme toggle (keeps original behavior)
  const docEl = document.documentElement;
  const toggle = document.getElementById('toggleTheme');
  const saved = localStorage.getItem('pr-theme') || 'light';
  if (saved === 'light') { docEl.classList.remove('dark'); docEl.classList.add('light'); }
  else { docEl.classList.remove('light'); docEl.classList.add('dark'); }
  function updateThemeIcon(){ toggle.textContent = docEl.classList.contains('light') ? '‚òÄÔ∏è' : 'üåô'; }
  updateThemeIcon();
  toggle.addEventListener('click', () => {
    if(docEl.classList.contains('light')) { docEl.classList.remove('light'); docEl.classList.add('dark'); localStorage.setItem('pr-theme','dark'); }
    else { docEl.classList.remove('dark'); docEl.classList.add('light'); localStorage.setItem('pr-theme','light'); }
    updateThemeIcon();
  });

  // Speed test implementation (lightweight)
  // Uses httpbin.org endpoints to stream bytes (CORS-enabled).
  // Configuration
  const DOWNLOAD_CHUNK_BYTES = 1024 * 1024; // 1 MB per chunk
  const DOWNLOAD_CHUNKS = 4;               // ~4 MB total (adjustable)
  const UPLOAD_BYTES = 512 * 1024;         // 0.5 MB upload
  const PING_COUNT = 5;                    // number of small pings to measure latency

  let abortController = null;

  // DOM refs
  const runBtn = document.getElementById('runBtn');
  const abortBtn = document.getElementById('abortBtn');
  const showMain = document.getElementById('showMain');
  const showLabel = document.getElementById('showLabel');
  const progressBar = document.getElementById('progressBar');
  const miniLatency = document.getElementById('miniLatency');
  const miniDownload = document.getElementById('miniDownload');
  const miniUpload = document.getElementById('miniUpload');
  const latencyLbl = document.getElementById('latencyLbl');
  const downloadLbl = document.getElementById('downloadLbl');
  const uploadLbl = document.getElementById('uploadLbl');
  const lastLatency = document.getElementById('lastLatency');
  const lastDownload = document.getElementById('lastDownload');
  const lastUpload = document.getElementById('lastUpload');
  const shareBtn = document.getElementById('shareBtn');

  async function measureLatency() {
    // Use small requests to measure RTT
    const pings = PING_COUNT;
    let sum = 0;
    for (let i=0;i<pings;i++){
      if (!abortController) throw new Error('aborted');
      const t0 = performance.now();
      // tiny fetch to httpbin (stream-bytes of 1 byte)
      await fetch(`https://httpbin.org/stream-bytes/32?seed=${Math.random()}`, { cache: 'no-store', signal: abortController.signal });
      const t1 = performance.now();
      sum += (t1 - t0);
      // slight delay between pings to avoid server burst
      await new Promise(r => setTimeout(r, 120));
    }
    const avg = sum / pings;
    return Math.round(avg);
  }

  async function measureDownload(onProgress) {
    // download multiple 1MB chunks and time them
    let totalBytes = 0;
    let totalTime = 0;
    for (let i=0;i<DOWNLOAD_CHUNKS;i++){
      if (!abortController) throw new Error('aborted');
      const url = `https://httpbin.org/stream-bytes/${DOWNLOAD_CHUNK_BYTES}?seed=${Math.random()}`;
      const t0 = performance.now();
      const res = await fetch(url, { cache: 'no-store', signal: abortController.signal });
      // stream the body to drain it and count bytes (some servers report content-length but we'll read)
      const reader = res.body.getReader();
      let chunkSum = 0;
      while(true){
        const {done, value} = await reader.read();
        if (done) break;
        chunkSum += (value ? value.length : 0);
      }
      const t1 = performance.now();
      const took = (t1 - t0) / 1000; // seconds
      totalBytes += chunkSum;
      totalTime += took;
      onProgress && onProgress({ chunkIndex: i+1, chunks: DOWNLOAD_CHUNKS, chunkBytes: chunkSum, chunkTime: took, totalBytes, totalTime });
    }
    const bitsPerSec = (totalBytes * 8) / totalTime;
    const mbps = bitsPerSec / 1e6;
    return Math.max(0.01, Math.round(mbps * 100) / 100);
  }

  async function measureUpload() {
    // create a blob of specified size and POST to httpbin
    const size = UPLOAD_BYTES;
    const chunk = new Uint8Array(size);
    // fill with random-ish data
    for (let i=0;i<size;i+=1024) chunk[i] = (i * 31) % 256;
    const blob = new Blob([chunk]);

    const t0 = performance.now();
    const res = await fetch('https://httpbin.org/post', {
      method: 'POST',
      body: blob,
      cache: 'no-store',
      signal: abortController.signal,
      headers: { 'Content-Type': 'application/octet-stream' }
    });
    const t1 = performance.now();
    if (!res.ok) throw new Error('Upload failed');
    const took = (t1 - t0) / 1000;
    const bitsPerSec = (size * 8) / took;
    const mbps = bitsPerSec / 1e6;
    return Math.max(0.01, Math.round(mbps * 100) / 100);
  }

  function setProgress(pct){
    progressBar.style.width = Math.max(0, Math.min(100, pct)) + '%';
  }

  async function runFullTest() {
    abortController = new AbortController();
    runBtn.disabled = true; abortBtn.style.display = 'inline-block'; runBtn.textContent = 'Running...';
    showMain.textContent = 'Testing‚Ä¶';
    showLabel.textContent = 'Measuring latency first';
    setProgress(5);
    miniLatency.textContent = '‚Äî';
    miniDownload.textContent = '‚Äî';
    miniUpload.textContent = '‚Äî';

    try {
      // 1) latency
      const latency = await measureLatency();
      latencyLbl.textContent = latency + ' ms';
      miniLatency.textContent = latency + ' ms';
      setProgress(20);

      // 2) download
      showLabel.textContent = 'Measuring download';
      const download = await measureDownload(({chunkIndex, chunks, chunkTime})=>{
        const pct = 20 + (chunkIndex / chunks) * 60;
        setProgress(pct);
      });
      downloadLbl.textContent = download + ' Mbps';
      miniDownload.textContent = download + ' Mbps';
      setProgress(85);

      // 3) upload
      showLabel.textContent = 'Measuring upload';
      const upload = await measureUpload();
      uploadLbl.textContent = upload + ' Mbps';
      miniUpload.textContent = upload + ' Mbps';
      setProgress(100);

      // show main number (download primary)
      showMain.textContent = download + ' Mbps';
      showLabel.textContent = 'Download (primary). Tip: run a few times.';
      // save last result
      lastLatency.textContent = latency + ' ms';
      lastDownload.textContent = download + ' Mbps';
      lastUpload.textContent = upload + ' Mbps';

      // update share link
      shareBtn.href = `mailto:?subject=My%20Speed%20Test%20Result&body=Latency:%20${latency}ms%0ADownload:%20${download}Mbps%0AUpload:%20${upload}Mbps`;
    } catch (err) {
      if (err.name === 'AbortError') {
        showLabel.textContent = 'Test aborted';
        showMain.textContent = '‚Äî';
      } else {
        console.error(err);
        showLabel.textContent = 'Error running test ‚Äî ' + (err.message || 'unknown');
        showMain.textContent = '‚Äî';
      }
      setProgress(0);
    } finally {
      abortController = null;
      runBtn.disabled = false; abortBtn.style.display = 'none'; runBtn.textContent = 'Run test';
    }
  }

  runBtn.addEventListener('click', runFullTest);
  document.getElementById('runTestBtn').addEventListener('click', runFullTest);

  abortBtn.addEventListener('click', ()=>{
    if (abortController) {
      abortController.abort();
      abortController = null;
      runBtn.disabled = false; abortBtn.style.display = 'none'; runBtn.textContent = 'Run test';
    }
  });

  // quick helper: Stop button in hero
  const stopHero = document.getElementById('stopTestBtn');
  stopHero.addEventListener('click', () => {
    if (abortController) { abortController.abort(); abortController = null; }
    stopHero.style.display = 'none';
  });

  // optional: share via Web Share API
  shareBtn.addEventListener('click', (e) => {
    // allow default mailto as fallback; we won't block it.
  });
</script>
</body>
</html>
