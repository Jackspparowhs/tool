<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Speed Test ‚Äî PirateRuler.com</title>
<meta name="description" content="Speed Test by PirateRuler ‚Äî quick client-side internet speed check (download / upload / ping)." />
<meta name="theme-color" content="#071225" />
<link rel="icon" href="https://pirateruler.com/static/pr-logo.png" type="image/png">
<style>
  /* Design tokens kept from your theme ‚Äî small tweaks for clarity */
  :root{
    --space: 16px;
    --radius: 14px;
    --text-sans: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Helvetica Neue";
    --accent-a: #0A84FF; /* blue accent for this tool */
    --accent-b: #4CC0FF;
    --bg: linear-gradient(180deg,#f7fbfe,#f3f7fb);
    --card-dark: linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.01));
    --muted: #6b7480;
    --text: #071225;
    --shadow-soft: 0 10px 30px rgba(2,8,20,0.06);
    --max-width: 1100px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    font-family:var(--text-sans);
    color:var(--text);
    background:var(--bg);
    padding:var(--space);
    line-height:1.45;
  }
  a{color:inherit;text-decoration:none}
  .wrap{max-width:var(--max-width);margin:0 auto;padding-bottom:60px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px;border-radius:12px;background:transparent;margin-bottom:12px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent-a),var(--accent-b));color:white;font-weight:900;font-size:18px;box-shadow:var(--shadow-soft);flex-shrink:0}
  .brand .title{font-weight:800;font-size:16px;line-height:1.05}
  .brand .sub{font-size:12px;color:var(--muted)}
  .controls{display:flex;gap:10px;align-items:center}
  .theme-btn{display:inline-flex;align-items:center;justify-content:center;padding:10px;border-radius:999px;background:var(--card-dark);border:0;width:48px;height:48px;box-shadow:var(--shadow-soft);cursor:pointer;color:var(--text)}
  .hamb{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:var(--card-dark);box-shadow:var(--shadow-soft);border:0;cursor:pointer}
  .hero{border-radius:18px;padding:20px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 18px 40px rgba(3,12,30,0.06);text-align:center;position:relative}
  .kicker{display:inline-block;padding:6px 12px;border-radius:999px;background:linear-gradient(90deg, rgba(0,0,0,0.02), rgba(0,0,0,0.01));color:var(--muted);font-weight:700;font-size:13px;margin-bottom:12px}
  .h1{font-size:28px;font-weight:900;margin:6px 0 8px;line-height:1.02}
  .lead{max-width:920px;margin:0 auto;color:var(--muted);font-size:15px}
  .hero-cta{margin-top:18px;display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
  .btn-primary{background:linear-gradient(90deg,var(--accent-a),var(--accent-b));color:white;padding:12px 20px;border-radius:12px;font-weight:900;border:0;box-shadow:0 14px 36px rgba(10,132,255,0.12)}
  .btn-ghost{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:10px 16px;border-radius:12px;color:var(--muted)}
  .main-grid{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:22px;align-items:start}
  @media(max-width:980px){.main-grid{grid-template-columns:1fr} .h1{font-size:22px}}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));border-radius:14px;padding:18px;box-shadow:var(--shadow-soft)}
  h2.section{margin:0 0 8px 0;font-size:18px;font-weight:900}
  /* Speed UI */
  .speed-card{display:flex;flex-direction:column;align-items:center;gap:12px;padding:20px;border-radius:14px}
  .big-num{font-size:42px;font-weight:900;color:var(--accent-a)}
  .subsmall{font-size:13px;color:var(--muted)}
  .meter{width:100%;max-width:680px;height:220px;border-radius:12px;background:linear-gradient(180deg,#fff,#f6f9ff);display:flex;align-items:center;justify-content:center;box-shadow:0 8px 30px rgba(10,20,40,0.06)}
  .meter-inner{display:flex;gap:36px;align-items:center}
  .stat-block{text-align:center}
  .stat-label{font-size:13px;color:var(--muted)}
  .stat-value{font-weight:900;font-size:24px;color:var(--accent-a)}
  canvas.spark {width:180px;height:40px; background:transparent}
  .controls-row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:8px}
  .btn {padding:10px 14px;border-radius:12px;border:0;font-weight:800;cursor:pointer}
  .btn-start{background:var(--accent-a);color:white;box-shadow:0 10px 30px rgba(10,132,255,0.12)}
  .btn-stop{background:#eee;color:var(--text);border:1px solid rgba(0,0,0,0.06)}
  /* sidebar/offcanvas behaves like the typing site modal on small screens */
  .offcanvas{position:fixed;right:12px;top:12px;width:340px;max-width:92vw;background:white;border-radius:14px;padding:14px;box-shadow:0 20px 60px rgba(0,0,0,0.12);transform:translateX(120%);transition:transform .28s ease;z-index:200;color:var(--text)}
  .offcanvas.open{transform:translateX(0)}
  @media(max-width:720px){
    .offcanvas{left:50%;top:auto;bottom:8px;transform:translate(-50%,120%);width:92vw;max-width:none}
    .offcanvas.open{transform:translate(-50%,0)}
  }
  /* footer credit */
  .credit{position:fixed;left:16px;bottom:12px;background:rgba(0,0,0,0.6);padding:6px 10px;color:white;border-radius:8px;font-size:13px;z-index:100}
  /* helper */
  .row{display:flex;gap:12px;align-items:center}
  .muted{color:var(--muted)}
  .small{font-size:13px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">PR</div>
        <div>
          <!-- force wrap into two lines if needed -->
          <div class="title">Speed Test</div>
          <div class="sub small">Speed Test by PirateRuler.com</div>
        </div>
      </div>

      <div class="controls" role="navigation" aria-label="Header controls">
        <button id="toggleTheme" class="theme-btn" title="Toggle theme">‚òÄÔ∏è</button>
        <button id="openMenu" class="hamb" aria-controls="menu" aria-expanded="false" title="Menu">‚ò∞</button>
      </div>
    </header>

    <section class="hero">
      <div class="kicker">Client-side demo ‚Ä¢ Browser-only</div>
      <h1 class="h1">Quick Internet Speed Check</h1>
      <p class="lead">Client-only speed test using progressive downloads & uploads. Live graphs update every second. For best accuracy use your own server with large CORS-enabled files.</p>

      <div style="margin-top:14px" class="speed-card panel">
        <div class="meter" role="region" aria-label="Speed meter">
          <div class="meter-inner">
            <div class="stat-block">
              <div class="stat-label">Download</div>
              <div id="dlValue" class="stat-value">‚Äî Mbps</div>
              <div class="subsmall">Live</div>
            </div>

            <div style="min-width:240px;text-align:center">
              <div id="bigNum" class="big-num">‚Äî</div>
              <div class="subsmall">Current throughput</div>
              <canvas id="spark" class="spark"></canvas>
            </div>

            <div class="stat-block">
              <div class="stat-label">Upload</div>
              <div id="ulValue" class="stat-value">‚Äî Mbps</div>
              <div class="subsmall">Live</div>
            </div>
          </div>
        </div>

        <div class="controls-row">
          <button id="startBtn" class="btn btn-start">Start Test</button>
          <button id="stopBtn" class="btn btn-stop">Stop</button>
          <div class="row muted small">Ping: <span id="pingVal">‚Äî</span> ms</div>
          <div class="row muted small">Server: <span id="srvName">Public demo</span></div>
        </div>

        <div style="margin-top:10px;text-align:center" class="small muted">Results update every second. Close other network-heavy apps for best accuracy.</div>
      </div>
    </section>

    <div class="main-grid">
      <div>
        <section class="panel">
          <h2 class="section">How it works</h2>
          <p class="muted">This performs progressive downloads from public endpoints and measures bytes received per time to compute Mbps. Upload is a POST of large binary data to a public echo endpoint. For production accuracy replace the test URLs with your own CORS-enabled files and endpoints hosted near your users.</p>
        </section>

        <section class="panel" style="margin-top:14px">
          <h2 class="section">Advanced</h2>
          <ul class="muted small">
            <li>Parallel downloads increase accuracy on high-speed links.</li>
            <li>Progressive streaming: the test measures continuously as data arrives.</li>
            <li>Upload uses POST to a public echo endpoint (change to your endpoint for production).</li>
          </ul>
        </section>
      </div>

      <aside class="panel right-col">
        <h3 style="margin-top:0">Latest results</h3>
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:10px">
          <div class="row"><strong>Download:</strong>&nbsp;<span id="dlLive">‚Äî Mbps</span></div>
          <div class="row"><strong>Upload:</strong>&nbsp;<span id="ulLive">‚Äî Mbps</span></div>
          <div class="row"><strong>Ping:</strong>&nbsp;<span id="pingLive">‚Äî ms</span></div>
          <div class="row"><strong>IP:</strong>&nbsp;<span id="ipAddr">‚Äî</span></div>
        </div>

        <div style="height:12px"></div>
        <button id="copyBtn" class="btn btn-start" style="width:100%">Copy results</button>
      </aside>
    </div>

    <footer style="margin-top:22px;text-align:center">
      <small style="color:var(--muted)">¬© <span id="year"></span> PirateRuler ‚Äî Speed Checker</small>
    </footer>
  </div>

  <!-- offcanvas menu -->
  <div id="menu" class="offcanvas" role="dialog" aria-hidden="true" aria-label="Site menu">
    <h3 style="margin:0 0 8px 0">Menu</h3>
    <p class="muted" style="margin-top:0;margin-bottom:10px">Quick links & actions</p>
    <a href="#start" style="display:block;padding:10px;border-radius:10px;background:#f7f9fb;margin-bottom:6px">Start Test</a>
    <a href="#faq" style="display:block;padding:10px;border-radius:10px;background:#f7f9fb;margin-bottom:6px">FAQ</a>
    <a href="https://pirateruler.com" target="_blank" style="display:block;padding:10px;border-radius:10px;background:#f7f9fb;margin-bottom:6px">PirateRuler.com</a>
    <div style="height:12px"></div>
    <button id="closeMenu" style="padding:10px;border-radius:10px;border:0;background:linear-gradient(90deg,#fff,#ddd);width:100%;font-weight:800">Close</button>
  </div>

  <div class="credit">Powered by PirateRuler.com</div>

<script>
  // small helpers
  const $ = (id)=>document.getElementById(id);
  document.getElementById('year').textContent = new Date().getFullYear();

  // Offcanvas menu behavior (sidebar on desktop, bottom sheet on mobile)
  const menu = $('menu');
  document.getElementById('openMenu').addEventListener('click', ()=>{
    menu.classList.add('open'); menu.setAttribute('aria-hidden','false');
  });
  document.getElementById('closeMenu').addEventListener('click', ()=>{
    menu.classList.remove('open'); menu.setAttribute('aria-hidden','true');
  });

  // theme toggle simple
  const toggle = document.getElementById('toggleTheme');
  toggle.addEventListener('click', ()=>{
    document.documentElement.classList.toggle('light');
    toggle.textContent = document.documentElement.classList.contains('light') ? 'üåû' : '‚òÄÔ∏è';
  });

  // Sparkline canvas
  const spark = $('spark');
  const ctx = spark.getContext('2d');
  const samples = [];
  function drawSpark(){
    const w = spark.width = spark.clientWidth * devicePixelRatio;
    const h = spark.height = spark.clientHeight * devicePixelRatio;
    ctx.clearRect(0,0,w,h);
    ctx.lineWidth = 2 * devicePixelRatio;
    ctx.strokeStyle = '#0A84FF';
    ctx.beginPath();
    const N = samples.length || 1;
    for(let i=0;i<N;i++){
      const x = (i/(N-1 || 1))*w;
      const v = samples[i] || 0;
      const y = h - (Math.min(v,100)*h/100); // cap visual to 100 Mbps
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.stroke();
  }

  // Measurement state
  let running = false;
  let dlMbps = 0, ulMbps = 0, pingMs = 0;
  let dlInterval, ulInterval, pingInterval;
  let controller; // for aborting fetches

  // Public demo endpoints (replace these with your own CORS-enabled files in production).
  // Note: Some browsers / networks may block these endpoints; swap for your hosted test files for best accuracy.
  const DOWNLOAD_URLS = [
    // stream-bytes from httpbin (public demo endpoints that support streaming). If you host files, replace these.
    'https://httpbin.org/stream-bytes/2000000?seed=1&chunk_size=1024',
    'https://httpbin.org/stream-bytes/2000000?seed=2&chunk_size=1024'
  ];
  const UPLOAD_URL = 'https://httpbin.org/post'; // echo endpoint for demo (CORS-enabled)

  // Ping: measure RTT by fetching a tiny resource (or a HEAD)
  async function measurePing(){
    try{
      const start = performance.now();
      // tiny request to httpbin (HEAD-like)
      await fetch('https://httpbin.org/get?ttl=' + Math.random(), {cache:'no-store', mode:'cors'});
      const end = performance.now();
      pingMs = Math.round(end - start);
      $('pingVal').textContent = pingMs;
      $('pingLive').textContent = pingMs;
    }catch(e){
      $('pingVal').textContent = '‚Äî';
      $('pingLive').textContent = '‚Äî';
    }
  }

  // Download test: progressive read bytes and compute throughput
  async function downloadTest(onTick, duration=12000){
    // duration ms per URL set; we will stream sequentially across URLs and measure bytes/time
    controller = new AbortController();
    const signal = controller.signal;
    let totalBytes = 0;
    const startTime = performance.now();
    const perSecStats = []; // samples every second
    let lastTime = performance.now();
    let lastBytes = 0;

    // we will run readable stream and stop after duration
    const stopAt = startTime + duration;
    for(const url of DOWNLOAD_URLS){
      if(performance.now() > stopAt || signal.aborted) break;
      try{
        const resp = await fetch(url, {cache:'no-store',signal});
        if(!resp.ok || !resp.body) continue;
        const reader = resp.body.getReader();
        while(true){
          const now = performance.now();
          if(now > stopAt || signal.aborted){ reader.cancel(); break; }
          const {done, value} = await reader.read();
          if(done) break;
          totalBytes += (value ? value.byteLength : 0);
          const tNow = performance.now();
          // every ~500ms call onTick to update UI
          if(tNow - lastTime >= 500){
            const deltaBytes = totalBytes - lastBytes;
            const deltaS = (tNow - lastTime)/1000;
            const mbps = (deltaBytes * 8) / (deltaS * 1000 * 1000); // Mbps
            lastBytes = totalBytes;
            lastTime = tNow;
            perSecStats.push(mbps);
            onTick({mbps, totalBytes, elapsed: (tNow-startTime)/1000});
            // cap perSecStats to 50 samples
            if(perSecStats.length>50) perSecStats.shift();
          }
        }
      }catch(err){
        // fetch error ‚Äî ignore and continue
        console.warn('download fetch error', err);
      }
    }
    // compute average for the whole run
    const totalTimeSec = (performance.now() - startTime)/1000 || 1;
    const avgMbps = (totalBytes * 8) / (totalTimeSec * 1000 * 1000);
    return {avgMbps, totalBytes, perSecStats};
  }

  // Upload test: POST generated random data blob and measure bytes sent / time
  async function uploadTest(onTick, duration=8000){
    // generate a random Uint8Array of a certain size (repeat if needed)
    // For demo: generate 4MB payload repeated
    const chunkSize = 1024*1024; // 1MB
    const totalSizeTarget = 6 * 1024 * 1024; // 6 MB total attempt
    const blobParts = [];
    const rng = crypto.getRandomValues.bind(crypto);
    let generated = 0;
    while(generated < totalSizeTarget){
      const arr = new Uint8Array(Math.min(chunkSize, totalSizeTarget - generated));
      rng(arr);
      blobParts.push(arr);
      generated += arr.byteLength;
    }
    const payload = new Blob(blobParts, {type:'application/octet-stream'});
    const start = performance.now();
    try{
      // send and measure
      await fetch(UPLOAD_URL, {method:'POST', mode:'cors', body: payload, cache:'no-store'});
      const durationSec = (performance.now() - start)/1000;
      const mbps = (generated * 8) / (durationSec * 1000 * 1000);
      onTick({mbps, durationSec, bytes: generated});
      return {mbps, durationSec, bytes: generated};
    }catch(err){
      console.warn('upload error', err);
      return {mbps:0};
    }
  }

  // UI wiring
  const startBtn = $('startBtn'), stopBtn = $('stopBtn');
  const dlValue = $('dlValue'), ulValue = $('ulValue'), bigNum = $('bigNum');
  const dlLive = $('dlLive'), ulLive = $('ulLive'), pingLive = $('pingLive'), ipAddr = $('ipAddr');

  // helper to show a numeric value nicely
  function fmt(v){ return (Math.round(v*100)/100).toLocaleString(); }

  function onDownloadTick(sample){
    // sample.mbps is instantaneous sample
    dlMbps = sample.mbps;
    samples.push(dlMbps);
    if(samples.length>40) samples.shift();
    // update UI
    dlValue.textContent = fmt(dlMbps) + ' Mbps';
    dlLive.textContent = fmt(dlMbps) + ' Mbps';
    bigNum.textContent = fmt(dlMbps) + ' Mbps';
    // update sparkline samples array (capped)
    drawSpark();
  }

  async function runTestSequence(){
    running = true;
    startBtn.disabled = true;
    stopBtn.disabled = false;
    // measure ping repeatedly
    measurePing(); // one immediately
    pingInterval = setInterval(measurePing, 4000);

    // fetch ip (for display)
    try{
      const r = await fetch('https://httpbin.org/ip');
      const j = await r.json();
      ipAddr.textContent = j.origin || j.ip || '‚Äî';
    }catch(e){ ipAddr.textContent = '‚Äî'; }

    // download phase
    $('srvName').textContent = 'Public demo (httpbin)';

    // perform progressive download for ~12s
    const dlRes = await downloadTest(onDownloadTick, 12000);

    // small pause
    await new Promise(r=>setTimeout(r,350));

    // upload phase
    const ulSample = await uploadTest((s)=>{
      ulMbps = s.mbps || 0;
      ulValue.textContent = fmt(ulMbps) + ' Mbps';
      ulLive.textContent = fmt(ulMbps) + ' Mbps';
    }, 8000);

    // finalize
    running = false;
    startBtn.disabled = false;
    stopBtn.disabled = true;
    clearInterval(pingInterval);

    // show averages
    if(dlRes && dlRes.avgMbps){
      dlValue.textContent = fmt(dlRes.avgMbps) + ' Mbps';
      dlLive.textContent = fmt(dlRes.avgMbps) + ' Mbps';
      bigNum.textContent = fmt(dlRes.avgMbps) + ' Mbps';
    }
    if(ulSample && ulSample.mbps){
      ulValue.textContent = fmt(ulSample.mbps) + ' Mbps';
      ulLive.textContent = fmt(ulSample.mbps) + ' Mbps';
    }
    // push final spark draw
    drawSpark();
  }

  startBtn.addEventListener('click', async ()=>{
    if(running) return;
    samples.length = 0;
    drawSpark();
    runTestSequence().catch(err=>{
      console.error(err);
      running = false;
      startBtn.disabled = false;
      stopBtn.disabled = true;
    });
  });

  stopBtn.addEventListener('click', ()=>{
    if(controller) controller.abort();
    running = false;
    startBtn.disabled = false;
    stopBtn.disabled = true;
    clearInterval(pingInterval);
  });

  // copy results
  $('copyBtn').addEventListener('click', ()=>{
    const txt = `Download: ${dlLive.textContent}\nUpload: ${ulLive.textContent}\nPing: ${pingLive.textContent}\nIP: ${ipAddr.textContent}`;
    navigator.clipboard?.writeText(txt).then(()=>alert('Results copied')).catch(()=>alert('Copy failed'));
  });

  // keep spark alive even before test
  for(let i=0;i<10;i++) samples.push(0);
  drawSpark();
</script>
</body>
</html>
