<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Map — PirateRuler</title>
<meta name="description" content="Clean full-screen map by PirateRuler — Apple-like look (no API key)." />
<meta name="theme-color" content="#0a1b3a" />
<link rel="icon" href="https://pirateruler.com/static/pr-logo.png" type="image/png">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
  /* ----- Tokens ----- */
  :root{
    --bg: #071225;
    --ui-blue: #0077ff;   /* Apple-like blue */
    --ui-blue-2: #005ecc;
    --muted: #9bb1cf;
    --glass: rgba(255,255,255,0.06);
  }
  html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;background:var(--bg);color:#fff}
  a{color:inherit}
  /* ----- header: very small and unobtrusive ----- */
  header{
    position:fixed; top:10px; left:12px; z-index:1400;
    display:flex; align-items:center; gap:10px;
    padding:6px 8px; border-radius:12px; background:rgba(255,255,255,0.03);
    backdrop-filter: blur(6px);
    box-shadow:0 8px 30px rgba(2,8,20,0.45);
    pointer-events:none; /* overall header not clickable except buttons */
  }
  .logo {
    width:44px; height:44px; border-radius:10px; background:linear-gradient(135deg,var(--ui-blue),var(--ui-blue-2));
    display:flex; align-items:center; justify-content:center; font-weight:900; color:white; font-size:16px;
    pointer-events:auto;
  }
  .hdr-text {display:flex; flex-direction:column; line-height:1; transform: translateY(2px); pointer-events:none;}
  .hdr-title{font-weight:800;font-size:14px; color: rgba(255,255,255,0.95)}
  .hdr-sub{font-size:11px;color:var(--muted); margin-top:2px; display:block}

  /* ----- control overlay ----- */
  .controls {
    position:fixed; top:16px; right:16px; z-index:1400; display:flex; gap:10px; flex-direction:column; pointer-events:auto;
  }
  .btn {
    display:inline-flex; align-items:center; gap:8px; justify-content:center;
    min-width:84px; padding:10px 12px; border-radius:12px; background:linear-gradient(180deg,var(--ui-blue),var(--ui-blue-2));
    color:white; font-weight:800; border:0; box-shadow: 0 8px 24px rgba(9,30,66,0.35);
    cursor:pointer;
  }
  .btn.ghost {
    background: rgba(255,255,255,0.06); color: #dfefff; border: 0; box-shadow:none; font-weight:700;
  }

  /* compact icon style like Apple Maps */
  .icon-btn {
    width:48px;height:48px;border-radius:12px;background:rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:center;border:0;color:#fff;cursor:pointer;
  }

  /* ----- map fills screen ----- */
  #map { position:fixed; inset:0; z-index:0; }

  /* ----- small attribution (very small) ----- */
  .attribution {
    position:fixed; left:12px; bottom:12px; z-index:1400;
    background: rgba(0,0,0,0.45); color:#d7e6ff; font-size:12px; padding:6px 8px; border-radius:8px;
  }

  /* Leaflet popup light on dark bg */
  .leaflet-popup-content-wrapper { background:#fff; color:#06203a; border-radius:10px; }
  .leaflet-popup-tip { background:#fff; }

  /* adjust mobile */
  @media(max-width:720px){
    .controls{ right:10px; gap:8px }
    .btn{ min-width:72px; padding:8px 10px; font-size:14px }
    header{ top:8px; left:8px }
  }
</style>
</head>
<body>

  <!-- tiny header -->
  <header aria-hidden="true">
    <div class="logo" title="PirateRuler">PR</div>
    <div class="hdr-text">
      <div class="hdr-title">Map</div>
      <div class="hdr-sub">by PirateRuler</div>
    </div>
  </header>

  <!-- minimal controls -->
  <div class="controls" role="toolbar" aria-label="Map controls">
    <button id="locateBtn" class="btn" title="Locate me">Locate</button>
    <button id="searchOpen" class="btn ghost" title="Search">Search</button>
    <button id="clearBtn" class="icon-btn" title="Clear" aria-label="Clear markers">✖</button>
  </div>

  <!-- the map -->
  <div id="map" aria-label="Map"></div>

  <!-- tiny attribution -->
  <div class="attribution" id="attr">PirateRuler.com</div>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
  /* ===== Apple-like full-screen map (Leaflet) =====
     - Uses smooth pastel tiles similar to Apple Maps look (Carto/Stadia)
     - Minimal header, Apple-like blue buttons, tiny attribution
     - Click to drop marker; locate button centers user
     - No external API keys required
     - If you want real Apple Maps (MapKit JS) I can provide that code but you need an Apple key + enable domain
  */

  // Create map (world view)
  const map = L.map('map', { zoomControl: true, attributionControl: false }).setView([22.0, 78.0], 4);

  // Use a soft, pastel tile set — Stadia/Carto "alidade_smooth" / positron-style
  L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // Add subtle scale control on top-left (Apple-like)
  L.control.scale({ position: 'bottomleft', imperial: false }).addTo(map);

  // marker layer
  const markerLayer = L.layerGroup().addTo(map);

  // locate button
  const locateBtn = document.getElementById('locateBtn');
  locateBtn.addEventListener('click', () => {
    if(!navigator.geolocation) { alert('Geolocation not supported'); return; }
    locateBtn.disabled = true; locateBtn.textContent = 'Locating…';
    navigator.geolocation.getCurrentPosition((pos) => {
      locateBtn.disabled = false; locateBtn.textContent = 'Locate';
      const lat = pos.coords.latitude, lon = pos.coords.longitude;
      placeMarker(lat, lon, 'You are here');
      map.setView([lat, lon], 13);
    }, (err) => {
      locateBtn.disabled = false; locateBtn.textContent = 'Locate';
      alert('Location error: ' + (err.message || err.code));
    }, { enableHighAccuracy: true, timeout: 10000 });
  });

  // simple search overlay (modal-style small prompt) — minimal UI to keep page clean
  document.getElementById('searchOpen').addEventListener('click', async () => {
    const q = prompt('Search place, address, or airport (type and press OK):');
    if(!q) return;
    // Nominatim public search
    const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}&limit=6`;
    try {
      const r = await fetch(url, {headers:{'Accept-Language':'en'}});
      if(!r.ok) throw new Error('HTTP ' + r.status);
      const j = await r.json();
      if(!j || j.length === 0) { alert('No results'); return; }
      const first = j[0];
      const lat = parseFloat(first.lat), lon = parseFloat(first.lon);
      placeMarker(lat, lon, first.display_name || q);
      map.setView([lat, lon], 13);
    } catch(e) {
      console.warn('Search failed', e);
      alert('Search failed');
    }
  });

  // click to add marker
  map.on('click', (e) => {
    placeMarker(e.latlng.lat, e.latlng.lng, 'Pinned location');
  });

  // place marker helper
  function placeMarker(lat, lon, label){
    markerLayer.clearLayers();
    const m = L.marker([lat, lon], {
      riseOnHover: true
    }).addTo(markerLayer);
    const content = `<div style="font-weight:900">${escapeHtml(label || 'Location')}</div>
                     <div style="font-size:13px;color:#334">${lat.toFixed(6)}, ${lon.toFixed(6)}</div>`;
    m.bindPopup(content).openPopup();
  }

  // clear
  document.getElementById('clearBtn').addEventListener('click', () => markerLayer.clearLayers());

  // tiny helper
  function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch])); }

  // make sure map fills correctly on mobile (fix rendering glitch)
  setTimeout(()=> map.invalidateSize(), 100);

  // optional: add globe-like view on small zooms (simulate by setting minZoom)
  map.setMinZoom(2);

  // Remove default big leaflet attribution UI so the page looks minimal
  // We still use a tiny custom attribution per your request (PirateRuler.com)
  </script>
</body>
</html>
